#!/bin/bash
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do # resolve $SOURCE until the file is no longer a symlink
  TARGET="$(readlink "$SOURCE")"
  if [[ $TARGET == /* ]]; then
    #echo "SOURCE '$SOURCE' is an absolute symlink to '$TARGET'"
    SOURCE="$TARGET"
  else
    DIR="$( dirname "$SOURCE" )"
    #echo "SOURCE '$SOURCE' is a relative symlink to '$TARGET' (relative to '$DIR')"
    SOURCE="$DIR/$TARGET" # if $SOURCE was a relative symlink, we need to resolve it relative to the path where the symlink file was located
  fi
done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

echo @@@@@@Starting project boilerplate@@@@@@

read -p "What will you call this project? " projectNamevar


echo Creating project root dir on your desktop
cd ~/Desktop && mkdir $projectNamevar

echo Successfully created $projectNamevar under ~/Desktop
echo CD\'ing into project dir
cd $projectNamevar

echo Initializing git
git init

echo Generating basic gitignore file
echo \#\# This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') > .gitignore
cat $DIR/src/gitignore > .gitignore

echo Creating basic project structure
echo // This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') > index.html
cat $DIR/src/index > index.html
mkdir -p assets/js && mkdir -p assets/css && mkdir -p assets/images
touch assets/css/app.css && touch assets/js/app.js && touch assets/js/app-interface.js

echo /\* This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') */ > assets/css/app.css
echo // This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') > assets/js/app.js

cp $DIR/src/media/js_gulp_gen_logo.png assets/images/js_gulp_gen_logo.png

echo /* This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') */ > assets/css/tailwind.css
echo "@tailwind preflight; @tailwind utilities;" > assets/css/tailwind.css

echo Initializing npm
npm init

echo Initializing bower
bower init

echo Installing dev npm packages

npm install autoprefixer babel-core babel-preset-env babelify bower-files browser-sync browserify del gulp gulp-clean-css gulp-concat gulp-imagemin gulp-jshint gulp-postcss gulp-uglify gulp-util jasmine@2.9.0 jasmine-core@2.9.1 jshint karma karma-browserify karma-chrome-launcher karma-cli karma-jasmine karma-jasmine-html-reporter karma-jquery tailwindcss vinyl-source-stream watchify --save-dev

echo Installing bower packages
bower install jquery --save

echo Creating gulpfile
echo // This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') > gulpfile.js
cat $DIR/src/gulpfile > gulpfile.js

echo Creating .jshintrc
echo "{ \"esversion\": 6 }" > .jshintrc

echo Initializing Jasmine
./node_modules/.bin/jasmine init

echo Deleting default jasmine.json
rm spec/support/jasmine.json

echo Creating new default jasmine.json
cat $DIR/src/jasmine > spec/support/jasmine.json

echo Initializing tailwindcss
./node_modules/.bin/tailwind init tailwind.js

echo Adding sample test spec to pass karma test run
echo // This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') > spec/app-spec.js
cat $DIR/src/test-spec > spec/app-spec.js

echo Initializing karma
karma init

echo Deleting generated karma.conf.js
rm karma.conf.js

echo Creating new karma.conf.js
echo // This file was automatically generated by js-gulp-gen $(date +'%a %b %d %Y @ %r') > karma.conf.js
cat $DIR/src/karma.conf > karma.conf.js

echo Running gulp task:jshint
gulp jshint

echo Running gulp task:build with '\--prod\' tag
gulp build --prod

# echo ***Following command will only work for mac users**
# osascript -e 'tell application "Terminal" to activate' -e 'tell application "System Events" to tell process "Terminal" to keystroke "t" using command down' -e 'tell application "Terminal" to do scriptcd ~/$("$projectNamevar") && gulp serve --prod in tab 2 of window 1'

echo *This will only work if you entered a test command when you initialized npm*
echo *If this fails check your test command in package.json*
echo Running npm test

npm run test
